<!-- pages/rank/rank.wxml -->
<view class=\"container rank-page\">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class=\"page-header\">
    <view class=\"header-content\">
      <text class=\"page-title\">ğŸ† æ’è¡Œæ¦œ</text>
      <text class=\"page-subtitle\">ä¸å¥½å‹æ¯”æ‹¼å‡€æ°´æŠ€èƒ½</text>
    </view>
    
    <!-- åˆ·æ–°æŒ‰é’® -->
    <view class=\"refresh-btn\" bindtap=\"onRefreshRank\">
      <text class=\"refresh-icon\">ğŸ”„</text>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œæ ‡ç­¾ -->
  <view class=\"rank-tabs\">
    <view 
      class=\"tab-item {{currentTab === 'score' ? 'active' : ''}}\"
      data-tab=\"score\"
      bindtap=\"onSwitchTab\"
    >
      <text class=\"tab-icon\">ğŸŒŸ</text>
      <text class=\"tab-text\">å¾—åˆ†æ¦œ</text>
    </view>
    
    <view 
      class=\"tab-item {{currentTab === 'level' ? 'active' : ''}}\"
      data-tab=\"level\"
      bindtap=\"onSwitchTab\"
    >
      <text class=\"tab-icon\">ğŸš€</text>
      <text class=\"tab-text\">å…³å¡æ¦œ</text>
    </view>
    
    <view 
      class=\"tab-item {{currentTab === 'friends' ? 'active' : ''}}\"
      data-tab=\"friends\"
      bindtap=\"onSwitchTab\"
    >
      <text class=\"tab-icon\">ğŸ‘¥</text>
      <text class=\"tab-text\">å¥½å‹æ¦œ</text>
    </view>
  </view>

  <!-- æˆ‘çš„æ’åä¿¡æ¯ -->
  <view class=\"my-rank-section\">
    <view class=\"my-rank-card\">
      <view class=\"rank-avatar\">
        <image class=\"avatar-image\" src=\"{{userInfo.avatarUrl || '/images/default_avatar.png'}}\" />
        <view class=\"rank-badge\">
          <text class=\"rank-number\"># {{myRank.position || '---'}}</text>
        </view>
      </view>
      
      <view class=\"rank-info\">
        <text class=\"user-name\">{{userInfo.nickName || 'æ¸¸å®¢'}}</text>
        <view class=\"user-stats\">
          <text class=\"stat-item\" wx:if=\"{{currentTab === 'score'}}\">æœ€é«˜å¾—åˆ†: {{myRank.score}}</text>
          <text class=\"stat-item\" wx:elif=\"{{currentTab === 'level'}}\">æœ€é«˜å…³å¡: {{myRank.level}}</text>
          <text class=\"stat-item\" wx:else>å¥½å‹æ•°: {{myRank.friendsCount}}</text>
        </view>
      </view>
      
      <view class=\"rank-trend\">
        <view class=\"trend-arrow {{myRank.trend}}\">
          <text wx:if=\"{{myRank.trend === 'up'}}\">â†—ï¸</text>
          <text wx:elif=\"{{myRank.trend === 'down'}}\">â†˜ï¸</text>
          <text wx:else>â¡ï¸</text>
        </view>
        <text class=\"trend-text\">{{myRank.trendText}}</text>
      </view>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
  <view class=\"rank-list-section\">
    <!-- å‰ä¸‰åç‰¹æ®Šæ˜¾ç¤º -->
    <view class=\"podium\" wx:if=\"{{rankList.length > 0}}\">
      <!-- ç¬¬äºŒå -->
      <view class=\"podium-item second\" wx:if=\"{{rankList[1]}}\">
        <view class=\"podium-rank\">ğŸ¥ˆ</view>
        <view class=\"podium-avatar\">
          <image class=\"avatar-image\" src=\"{{rankList[1].avatarUrl}}\" />
        </view>
        <text class=\"podium-name\">{{rankList[1].nickName}}</text>
        <text class=\"podium-score\">{{getCurrentTabValue(rankList[1])}}</text>
      </view>
      
      <!-- ç¬¬ä¸€å -->
      <view class=\"podium-item first\" wx:if=\"{{rankList[0]}}\">
        <view class=\"podium-rank\">ğŸ¥‡</view>
        <view class=\"podium-avatar champion\">
          <image class=\"avatar-image\" src=\"{{rankList[0].avatarUrl}}\" />
          <view class=\"champion-crown\">ğŸ‘‘</view>
        </view>
        <text class=\"podium-name\">{{rankList[0].nickName}}</text>
        <text class=\"podium-score\">{{getCurrentTabValue(rankList[0])}}</text>
      </view>
      
      <!-- ç¬¬ä¸‰å -->
      <view class=\"podium-item third\" wx:if=\"{{rankList[2]}}\">
        <view class=\"podium-rank\">ğŸ¥‰</view>
        <view class=\"podium-avatar\">
          <image class=\"avatar-image\" src=\"{{rankList[2].avatarUrl}}\" />
        </view>
        <text class=\"podium-name\">{{rankList[2].nickName}}</text>
        <text class=\"podium-score\">{{getCurrentTabValue(rankList[2])}}</text>
      </view>
    </view>
    
    <!-- æ’è¡Œæ¦œå…¶ä½™åæ¬¡ -->
    <view class=\"rank-list\">
      <view 
        class=\"rank-item {{item.isCurrentUser ? 'current-user' : ''}}\"
        wx:for=\"{{rankList}}\"
        wx:key=\"openId\"
        wx:if=\"{{index >= 3}}\"
        data-user=\"{{item}}\"
        bindtap=\"onViewUserProfile\"
      >
        <view class=\"rank-position\">
          <text class=\"position-number\">{{index + 1}}</text>
        </view>
        
        <view class=\"user-avatar\">
          <image class=\"avatar-image\" src=\"{{item.avatarUrl}}\" />
          <view class=\"online-indicator\" wx:if=\"{{item.isOnline}}\"></view>
        </view>
        
        <view class=\"user-info\">
          <text class=\"user-name\">{{item.nickName}}</text>
          <view class=\"user-details\">
            <text class=\"detail-item\" wx:if=\"{{currentTab === 'score'}}\">å¾—åˆ†: {{item.totalScore}}</text>
            <text class=\"detail-item\" wx:elif=\"{{currentTab === 'level'}}\">å…³å¡: {{item.maxLevel}}</text>
            <text class=\"detail-item\" wx:else>èƒœç‡: {{item.winRate}}%</text>
          </view>
        </view>
        
        <view class=\"rank-value\">
          <text class=\"value-main\">{{getCurrentTabValue(item)}}</text>
          <text class=\"value-label\">
            <text wx:if=\"{{currentTab === 'score'}}\">åˆ†</text>
            <text wx:elif=\"{{currentTab === 'level'}}\">å…³</text>
            <text wx:else>èƒœ</text>
          </text>
        </view>
        
        <view class=\"rank-actions\">
          <button 
            class=\"action-btn challenge-btn\"
            data-user=\"{{item}}\"
            bindtap=\"onChallengeUser\"
            wx:if=\"{{!item.isCurrentUser}}\"
          >
            æŒ‘æˆ˜
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œä¸ºç©º -->
  <view class=\"empty-rank\" wx:if=\"{{rankList.length === 0}}\">
    <text class=\"empty-icon\">ğŸ“Š</text>
    <text class=\"empty-text\">æš‚æ— æ’è¡Œæ•°æ®</text>
    <text class=\"empty-desc\">å¿«å»æ¸¸æˆä¸­æå‡åˆ†æ•°å§ï¼</text>
    <navigator class=\"btn btn-primary\" url=\"/pages/game/game\" hover-class=\"navigator-hover\">
      å¼€å§‹æ¸¸æˆ
    </navigator>
  </view>

  <!-- åº•éƒ¨åŠŸèƒ½åŒº -->
  <view class=\"bottom-actions\">
    <!-- åˆ†äº«æˆå°± -->
    <button class=\"action-card\" bindtap=\"onShareRank\" wx:if=\"{{myRank.position <= 10}}\">
      <view class=\"action-icon\">ğŸ“¤</view>
      <view class=\"action-text\">
        <text class=\"action-title\">åˆ†äº«æˆå°±</text>
        <text class=\"action-desc\">ç‚«è€€ä½ çš„æ’å</text>
      </view>
    </button>
    
    <!-- é‚€è¯·å¥½å‹ -->
    <button class=\"action-card\" bindtap=\"onInviteFriends\">
      <view class=\"action-icon\">ğŸ‘¥</view>
      <view class=\"action-text\">
        <text class=\"action-title\">é‚€è¯·å¥½å‹</text>
        <text class=\"action-desc\">ä¸€èµ·æ¥æ¯”æ‹¼</text>
      </view>
    </button>
    
    <!-- æŸ¥çœ‹å¥–åŠ± -->
    <button class=\"action-card\" bindtap=\"onViewRewards\">
      <view class=\"action-icon\">ğŸ</view>
      <view class=\"action-text\">
        <text class=\"action-title\">æ’åå¥–åŠ±</text>
        <text class=\"action-desc\">æŸ¥çœ‹å¥–åŠ±è§„åˆ™</text>
      </view>
    </button>
  </view>
</view>

<!-- ç”¨æˆ·è¯¦æƒ…å¼¹çª— -->
<view class=\"modal-overlay\" wx:if=\"{{showUserModal}}\" bindtap=\"onHideUserModal\">
  <view class=\"modal user-modal\" catchtap=\"stopPropagation\">
    <view class=\"modal-header\">
      <image class=\"user-detail-avatar\" src=\"{{selectedUser.avatarUrl}}\" />
      <text class=\"user-detail-name\">{{selectedUser.nickName}}</text>
    </view>
    
    <view class=\"modal-content\">
      <view class=\"user-stats-grid\">
        <view class=\"stat-card\">
          <text class=\"stat-value\">{{selectedUser.totalScore}}</text>
          <text class=\"stat-label\">æœ€é«˜å¾—åˆ†</text>
        </view>
        
        <view class=\"stat-card\">
          <text class=\"stat-value\">{{selectedUser.maxLevel}}</text>
          <text class=\"stat-label\">æœ€é«˜å…³å¡</text>
        </view>
        
        <view class=\"stat-card\">
          <text class=\"stat-value\">{{selectedUser.gamesPlayed}}</text>
          <text class=\"stat-label\">æ¸¸æˆæ¬¡æ•°</text>
        </view>
        
        <view class=\"stat-card\">
          <text class=\"stat-value\">{{selectedUser.winRate}}%</text>
          <text class=\"stat-label\">èƒœç‡</text>
        </view>
      </view>
      
      <view class=\"user-achievements\" wx:if=\"{{selectedUser.achievements.length > 0}}\">
        <text class=\"achievements-title\">ğŸ… æˆå°±å¾½ç« </text>
        <view class=\"achievements-list\">
          <view 
            class=\"achievement-badge\"
            wx:for=\"{{selectedUser.achievements}}\"
            wx:key=\"id\"
          >
            <text class=\"badge-icon\">{{item.icon}}</text>
            <text class=\"badge-name\">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class=\"modal-actions\">
      <button class=\"btn btn-outline\" bindtap=\"onHideUserModal\">å…³é—­</button>
      <button class=\"btn btn-primary\" data-user=\"{{selectedUser}}\" bindtap=\"onChallengeUser\">
        å‘èµ·æŒ‘æˆ˜
      </button>
    </view>
  </view>
</view>

<!-- å¥–åŠ±è§„åˆ™å¼¹çª— -->
<view class=\"modal-overlay\" wx:if=\"{{showRewardsModal}}\" bindtap=\"onHideRewardsModal\">
  <view class=\"modal rewards-modal\" catchtap=\"stopPropagation\">
    <view class=\"modal-title\">ğŸ æ’åå¥–åŠ±è§„åˆ™</view>
    
    <view class=\"modal-content\">
      <view class=\"rewards-list\">
        <view class=\"reward-tier\">
          <text class=\"tier-rank\">ğŸ¥‡ ç¬¬1å</text>
          <view class=\"tier-rewards\">
            <text class=\"reward-item\">â€¢ 1000é‡‘å¸</text>
            <text class=\"reward-item\">â€¢ ä¸“å±ç§°å·</text>
            <text class=\"reward-item\">â€¢ é«˜çº§é“å…·x5</text>
          </view>
        </view>
        
        <view class=\"reward-tier\">
          <text class=\"tier-rank\">ğŸ¥ˆ ç¬¬2-3å</text>
          <view class=\"tier-rewards\">
            <text class=\"reward-item\">â€¢ 500é‡‘å¸</text>
            <text class=\"reward-item\">â€¢ è£èª‰å¾½ç« </text>
            <text class=\"reward-item\">â€¢ ä¸­çº§é“å…·x3</text>
          </view>
        </view>
        
        <view class=\"reward-tier\">
          <text class=\"tier-rank\">ğŸ… ç¬¬4-10å</text>
          <view class=\"tier-rewards\">
            <text class=\"reward-item\">â€¢ 200é‡‘å¸</text>
            <text class=\"reward-item\">â€¢ è¿›æ­¥å¥–åŠ±</text>
            <text class=\"reward-item\">â€¢ åˆçº§é“å…·x2</text>
          </view>
        </view>
        
        <view class=\"reward-tier\">
          <text class=\"tier-rank\">ğŸ¯ ç¬¬11-50å</text>
          <view class=\"tier-rewards\">
            <text class=\"reward-item\">â€¢ 50é‡‘å¸</text>
            <text class=\"reward-item\">â€¢ å‚ä¸å¥–åŠ±</text>
          </view>
        </view>
      </view>
      
      <view class=\"reward-note\">
        <text class=\"note-title\">ğŸ“¢ ç»“ç®—è¯´æ˜</text>
        <text class=\"note-text\">â€¢ æ¯å‘¨æ—¥æ™šä¸Š22:00ç»“ç®—å¥–åŠ±</text>
        <text class=\"note-text\">â€¢ å¥–åŠ±å°†è‡ªåŠ¨å‘æ”¾åˆ°è´¦æˆ·</text>
        <text class=\"note-text\">â€¢ éœ€è¦å®Œæˆè‡³å°‘5å±€æ¸¸æˆæ‰èƒ½è·å¾—å¥–åŠ±</text>
      </view>
    </view>
    
    <view class=\"modal-actions\">
      <button class=\"btn btn-primary\" bindtap=\"onHideRewardsModal\">çŸ¥é“äº†</button>
    </view>
  </view>
</view>"